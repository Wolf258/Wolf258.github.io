  //Variable global
  total_output = document.getElementById("output_precio")
  descuento_output = document.getElementById("output_descuento")
  total_final_output = document.getElementById("output_final_output")

  total = 0
  descuento = 0
  resultado_to_fix = 0
 //Variable global

 //Variables necesarias para chekear si el cambio se ha dado
 let model_select
 let model
 let change_m = 0
 let alt = 0

 model = document.getElementById("model_select").addEventListener("change" , function(){
  model_select = this.options[this.selectedIndex]  
 
if (!model_select || !model_select.value || isNaN(parseInt(model_select.value))) {
 console.log("standby")

 
}else{   

 
  if(change_m == 0){
     //borramos el anterior numero si tiene un dato guardado quizas una iteracion del alt
     //piensa que total podria tener numeros!!!!!! 
     if (alt !== null ) {
         total -= alt
     
     }

    //guarda el valor del ultimo cambio dado.
     alt = parseInt(model_select.value, 10);

   //transforma el value a int.
    total += parseInt(model_select.value, 10);
    change_m = 1

    console.log(total + " total antes del cambio")
    console.log(model_select.text+ "  " + model_select.value   + " seleccionado")
    let total_display = total.toLocaleString('es-ES')
    total_output.innerHTML = total_display
    calcularDescuento()
    calcular_final_bruto()

 }else{

   model_select = this.options[this.selectedIndex]
   total-= parseInt(alt , 10)
   
   total += parseInt(model_select.value, 10);
   alt = parseInt(model_select.value, 10);
   console.log(total)
   //sustituimos el alt con el valor actual 
   //tengo que hacer que esto funcione en todas las iteraciones
   change_m = 0
   let total_display2 = total.toLocaleString('es-ES')
   total_output.innerHTML = total_display2;
   calcularDescuento()
   calcular_final_bruto()
 
 }


 } 
 })


//calculo de los colores

let color
let sted_color
let alt_c = 0
let change_c = 0

color = document.getElementById("Color").addEventListener("change" , function(){

 sted_color = this.options[this.selectedIndex]

if (change_c == 0) {
        
   if (alt_c !== null ) {
        total-= alt_c

   }

 alt_c = parseInt(sted_color.value) 
 total += alt_c
 change_c = 1   
 total_output.innerHTML = total;
 console.log(total + " A")
 calcularDescuento()
 calcular_final_bruto()

}else{

 sted_color = this.options[this.selectedIndex]   
 total -= alt_c   
 alt_c = parseInt(sted_color.value) 
 total+= alt_c   
 change_c = 0   
 total_output.innerHTML = total;
 console.log(total + " b")
 calcularDescuento()
 calcular_final_bruto()
}

})

const maxDescuento = 24;
const plazosInput = document.getElementById("plazos_input");


function calcularDescuento() {
  if (total != 0) {
      let plazos = parseInt(plazosInput.value); // ver que tengo numero entero
      let descuento;

      // tenerlos plazos seteados
      if (plazos >= 1 && plazos <= 24) {
          descuento = maxDescuento - (plazos - 1);
      } else {
          descuento = 0; 
      }

      let resultado = (total * descuento) / 100;
      descuento_output.innerHTML = descuento + " %";
      console.log(resultado + " aaaaaaaaa")
      resultado_to_fix = resultado.toFixed()
       
  }
}

// Ejecutar la función cuando la página se carga
document.addEventListener("DOMContentLoaded", calcularDescuento);

// Escuchar cambios en el input con "input" y "change"
plazosInput.addEventListener("input", calcularDescuento);
plazosInput.addEventListener("change", calcularDescuento);

function calcular_final_bruto() {
  console.log(total + resultado_to_fix + " variables");

  let total_final = total - resultado_to_fix;

  if (total_final != 0 && total_final != null && !isNaN(total_final)) {
    // Formatear total_final con separadores de miles
    let total_final_formatted = total_final.toLocaleString('es-ES');
    total_final_output.innerHTML = total_final_formatted;
  }
}

plazosInput.addEventListener("input" , calcular_final_bruto);
plazosInput.addEventListener("change" , calcular_final_bruto);


































































































































































































/*...................................................:........................................................
...............................................-+%@@@#+*++*##+-.............................................
............................................-#@@@@@@@@@@@@@@@@@@@#:.........................................
..........................................:*@@@@@@@@@@@@@@@@@@@@@@@%-.......................................
........................................+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@......................................
......................................+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@:....................................
.....................................#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-...................................
....................................*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+..................................
...................................=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*.................................
...................................+@@@@@@*+++====+**+*##%%@@@@@@@@@@@@@@@@+................................
...................................*@@@@@*+======---------===+#%@@@@@@@@@@@*................................
...................................%@@@@#++=======------------=+%@@@@@@@@@@%-...............................
...................................%@@@@++======--------------==#%@@@@@@@@@@+...............................
...................................%@@@#==---------------------=+#@@@@@@@@@@+...............................
..................................:%@@@*+=====------------------+#@@@@@@@@@@+...............................
..................................-*@@@#@@%%%#+++==-====++=+*+===+%@@@@@@@@#:...............................
..................................-=+@%*++++*#@@@#++*%@@@%+---==-=*%@@@@@@@%-...............................
..................................::=%%==#*:+@@@%%=-+#%@%%@%%#+---=%@@@%@@%#-...............................
.....................................=*=-=+#*%%%#+--=+#%#**+=-:----+@@@@*+%%-...............................
.....................................++=--=++++++=--===+**+=-:::--==@%%@@%--................................
....................................-@#+======+*+=-------==--:::-==+#++=#@-.................................
....................................#@@#+====+#+=----====--------==++=-=@%+.................................
...................................:#@@%#++=+%%==-----+*=------====+@##@@@#.................................
...................................-*#+###++*#%@@#*+*+=+==----=====+@@@@@@#:................................
...................................==--%****+**###%#+======---=====+@@@@#**-................................
...................................:.:#@%#+###*##+*+==++++=--=====++@@@@#==.................................
.....................................+#@@####%@@@@%%%##**+======++==@@@@@+-.................................
....................................:..@==#%%##@@%###+===++++++*+-==@#%+%+..................................
......................................-:.-%%##++***++==++++++*+---==@@#+::..................................
......................................-.%@@@@#+++*++=-===**#+---#@@@@@@%....................................
....................................#@@@@@@@*@%%########%#**%@@@@@@@@@@@....................................
................................:*@@@@@@@@@@+#%@@@@@%%%%@@@@@@@@@@@@@@@@:...................................
..............................=@@@@@@@@@@@@%**###%@@@@@@@@@@@@@@@@@@@%%%%%+.................................
.............................*@@@@@@@@@@@@@##+###%@@@@@@@@@@@@@@@@%%##%%%%#+:...............................
..........................:=+@@@@@@@@@@@@@@##+#@@@@@@@@@@@@@@@@@#%%#%%#%%%%%*=:.............................
......................:=+%%%%@@@@@@@@@@@@@@*#*%@@@@@@@@@@@@@@%%%##%%#%%%%%%%%#%#+=-.........................
...................:=#%%%%%%%@@@@@@@@@@@@%%*##%@@@@@@@@@@@@%%%##%##%%%#%%#%%#%##%#%#+=......................
..................+%%%@@%%%%%@@@@@@@@@%###*+**#@@@@@@@@@@%%##%%#%%@%%%%%%%%%%%%#%%#%%#%#-:..................
.................#%@@@@%%%%%@@@@@@@@@@%#++++++%@@@@@@@@@%%%%##%@@%%#%%%%%%%###%%###%%%%%##%#=...............
................#%@@@%%@@%%%@@@@@@@@@@%##**++%@@@@@@@@%%####%%@%%#%%%%%%%%%%%%%%%%%#%%%%%#%%%#=.............
...............=%@@@@%@@%%%@@@@@@@@%%#****#*@@@@@@@@@###%%#%@@%%%%%%%%%%%%%%%%%#%%%%#%%%%%#%%%%#-...........
..............:#@@@@@@%%%%@@@@@@@@###+++++*@@@@@@@@@###%%%@@@%%%%%%@@%%@%@%%%%%%%%%%%%#%%##%%##%*...........
..............=%@@@@@%%%#@@@@@@@@%##++=++#@@@@@@@@%#%##@@%%@%%%%%@@@%@@%%%%%%%%%%%%%%%%#%%%#%%%#%=..........
..............#@@@@@@%#%@@@@@@@@@%#*++*#%@@@@@@@@#%%##%%%@@%@@@%@@@@@@@@@@%@@%%%%%%%%%%%#%%%%%%#%#-.........
..............%@@@@@%%%@@@@@@@@@%#*++#*@@@@@@@@@#%#%%%%#%@@@@@%@@@@@@@@@%%%@@%%%%#%%%#%%%#%%%%%##%+.........
.............:%@@@@@%#%@@@@@@@%%%#+=*#@@@@@@@@%##%##%%#%@@@@@%@@@@@@@@@@@@@%%%%%%%%#%%######%%%%#%#-........
..............%@@@@%#%@@@@@@@@%%#+*#@@@@@@@@@%#%##%%#%%%@@@@%@@@@@@@@@@@@@@%%%%%%%%%#%%%##%###%%%%%+........
..............%@@@%#%@@@@@@@@@%#++#@@@@@@@@@##%##%##%%%@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%#%%%%%%#####%%#=.......
.............:%@@%##%@@@@@@@@@%##@@@@@@@@@@#%%##%%#%%@@@@@@@@@@@@@@@@@@@@@@@%%%%%#%%%%#%%%%%%%##%#%##=......
.............-#%%##%@@@@@@@@@@%@@@@@@@@@@@#%%##%%#%%%@@@@@@@@@@@@@@@@@@@@@@@%%%%%%##%#%##%%%%%%##%%%%#-.....
.............+%%%%%%@@@@@@@@@@@@@@@@@@@@%#%%#%%%#%@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%#%%%%##%###%%%%#%%%+.....
............-*%%%%%@@@@@@@@@@@@@@@@@@@@%#%%#%#%#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%@%%%%%%%%##%##%%%%%%##%=....
............=%%##%@@@@@@@@@@@@@@@@@@@@%#%%#%#%#@@%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%@%%%%%%#%%###%##%%%%#:...
...........:*%%#%@@@@@@@@@@@@@@@@@@@@%#%%##%#%@@%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@%%%%%@%%%#%%##%%##%%%%+...
...........-#%%%%@@@@@@@@@@@@@@@@@@@%%#%#%#%@@@@@%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%#%@%%%%%%##%%##%%%%-..
...........=%%#%@@@@@@@@@@@@@@@@@@@@%%%###%@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%#%%%%%%%%##%#%%%%#:.
...........+%%%%@@@@@@@@@@@@@@@@@@@##%##%@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%#%%%%##%%%%%%%%%%%##%%%*.
...........*%%%@@@@@@@@@@@@@@@@@@@%%%#%%%@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%#%%%%%##%#%##%%%%%%#%%#=
..........-#%%@@@@@@@@@@@@@@@@@@@@#%%#%@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#%%%%###%####%%%%%#%%% */  
  